<mxfile host="app.diagrams.net" modified="2025-07-13T10:00:00.000Z" version="24.6.4" type="browser">
  <diagram id="billing_flow" name="Billing Information Retrieval & Archiving">
    <mxGraphModel dx="1422" dy="807" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageEnabled="1" pageScale="1" pageWidth="850" pageHeight="1100" background="#ffffff" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="client" value="Client" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;" parent="1" vertex="1">
          <mxGeometry x="100" y="310" width="30" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="api" value="API Service" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="220" y="310" width="120" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="redis" value="Redis Cache" style="shape=cylinder;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
          <mxGeometry x="400" y="220" width="80" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="cosmos" value="Cosmos DB" style="shape=cylinder;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="400" y="350" width="80" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="blob" value="Azure Blob Storage (Hot/Cool)" style="shape=cloud;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="380" y="480" width="120" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="getRequest" value="Get Billing Info by ID" style="endArrow=classic;html=1;rounded=0;" parent="1" source="client" target="api" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="checkCache" value="Check Redis Cache" style="endArrow=classic;html=1;rounded=0;" parent="1" source="api" target="redis" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="cacheHit" value="Cache Hit?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="540" y="230" width="80" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="cacheYes" value="Yes (Return Data)" style="endArrow=classic;html=1;rounded=0;" parent="1" source="cacheHit" target="api" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="cacheNo" value="No" style="endArrow=classic;html=1;rounded=0;" parent="1" source="cacheHit" target="cosmos" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="queryCosmos" value="Check Cosmos DB" style="endArrow=classic;html=1;rounded=0;" parent="1" source="api" target="cosmos" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="cosmosHit" value="Data Found in Cosmos DB?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="540" y="360" width="80" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="cosmosYes" value="Yes (Return &amp; Cache to Redis)" style="endArrow=classic;html=1;rounded=0;" parent="1" source="cosmosHit" target="api" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="cosmosCache" value="Cache to Redis" style="endArrow=classic;html=1;rounded=0;dashed=1;" parent="1" source="cosmosHit" target="redis" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="cosmosNo" value="No" style="endArrow=classic;html=1;rounded=0;" parent="1" source="cosmosHit" target="blob" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="checkBlob" value="Check Blob Storage" style="endArrow=classic;html=1;rounded=0;" parent="1" source="api" target="blob" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="blobHit" value="Data Found in Blob Storage?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="540" y="490" width="80" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="blobYes" value="Yes (Return &amp; Cache to Redis)" style="endArrow=classic;html=1;rounded=0;" parent="1" source="blobHit" target="api" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="blobCache" value="Cache to Redis" style="endArrow=classic;html=1;rounded=0;dashed=1;" parent="1" source="blobHit" target="redis" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="blobNo" value="No (File Not Found)" style="endArrow=classic;html=1;rounded=0;" parent="1" source="blobHit" target="api" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="returnClient" value="Return Data to Client" style="endArrow=classic;html=1;rounded=0;" parent="1" source="api" target="client" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="cacheMgmt" value="Cache Management (LRU/TTL)" style="note;whiteSpace=wrap;html=1;backgroundOutline=1;fillColor=#f0f0f0;strokeColor=#333333;" parent="1" vertex="1">
          <mxGeometry x="600" y="190" width="160" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="cacheMgmtLink" value="" style="endArrow=open;html=1;rounded=0;dashed=1;endFill=0;endSize=12;" parent="1" source="cacheMgmt" target="redis" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <!-- Archiving Flow -->
        <mxCell id="adf" value="ADF Pipeline" style="shape=process;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" parent="1" vertex="1">
          <mxGeometry x="100" y="700" width="120" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="cosmos2" value="Cosmos DB" style="shape=cylinder;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
          <mxGeometry x="270" y="690" width="80" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="blob2" value="Azure Blob Storage (Cold Tier)" style="shape=cloud;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" parent="1" vertex="1">
          <mxGeometry x="500" y="690" width="120" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="dlq" value="DLQ / Notification" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;fillColor=#f0f0f0;strokeColor=#333333;" parent="1" vertex="1">
          <mxGeometry x="800" y="840" width="100" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="adfToCosmos" value="Schedule/Trigger Pipeline" style="endArrow=classic;html=1;rounded=0;" parent="1" source="adf" target="cosmos2" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="cosmosToBlob" value="Copy Data (Older than 90 days)" style="endArrow=classic;html=1;rounded=0;" parent="1" source="cosmos2" target="blob2" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="blobToCosmos" value="Delete from Cosmos DB (after copy)" style="endArrow=classic;html=1;rounded=0;" parent="1" source="blob2" target="cosmos2" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="adfStatus" value="Operation Status" style="rhombus;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" parent="1" vertex="1">
          <mxGeometry x="690" y="700" width="80" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="blobToStatus" value="Copy/Delete Completed?" style="endArrow=classic;html=1;rounded=0;" parent="1" source="blob2" target="adfStatus" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="statusSuccess" value="Success" style="endArrow=classic;html=1;rounded=0;" parent="1" source="adfStatus" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="statusFail" value="Failure (Retry 3x)" style="endArrow=classic;html=1;rounded=0;" parent="1" source="adfStatus" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="dlqLink" value="Retries Exhausted? Yes â†’ DLQ" style="endArrow=classic;html=1;rounded=0;" parent="1" source="adfStatus" target="dlq" edge="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
